<!DOCTYPE html>
<html>
<head>
    <title>After School Lessons</title>
    
    <!-- Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>

    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">
    <header>
        <h1>{{ sitename }}</h1>
        <button v-on:click="toggleCart" :disabled="cart.length === 0">
            {{ cartItemCount }}
            <i class="fa-solid fa-cart-plus"></i> Cart
        </button>
    </header>

    <main>
        <div v-if="currentPage === 'lessons'">
            <h2>Available Lessons</h2>

            <label>Sort by:</label>
            <select v-model="sortAttribute">
                <option value="subject">Subject</option>
                <option value="location">Location</option>
                <option value="price">Price</option>
                <option value="spaces">Spaces</option>
            </select>

            <button v-on:click="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">
                {{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }}
            </button>

            <div v-for="lesson in sortedLessons" :key="lesson.id" class="lesson-box">
                <h3><i :class="lesson.icon"></i> {{ lesson.subject }}</h3>
                <p>Location: {{ lesson.location }}</p>
                <p>Price: ${{ lesson.price }}</p>
                <p>Spaces left: {{ lesson.spaces - cartCount(lesson.id) }}</p>

                <button v-on:click="addToCart(lesson)" v-if="canAddToCart(lesson)">Add to Cart</button>

                <span v-if="lesson.spaces === cartCount(lesson.id)">All out!</span>
                <span v-else-if="lesson.spaces - cartCount(lesson.id) < 5">
                    Only {{ lesson.spaces - cartCount(lesson.id) }} left!
                </span>
                <span v-else>Buy now!</span>
            </div>
        </div>

        <!-- Cart Page -->
        <div v-if="currentPage === 'cart'">
            <h2>Your Cart</h2>
            <div v-for="(lesson, index) in cart" :key="index" class="cart-item">
                <h3>{{ lesson.subject }}</h3>
                <p>Location: {{ lesson.location }}</p>
                <p>Price: ${{ lesson.price }}</p>
                <button v-on:click="removeFromCart(index)">Remove</button>
            </div>
            <h3>Total: ${{ totalPrice }}</h3>
            <button v-on:click="goToCheckout" :disabled="cart.length === 0">Checkout</button>
            <button v-on:click="backToLessons">Back to Lessons</button>
        </div>

        <div v-if="currentPage === 'checkout'">
            <h2>Checkout</h2>
            <p>
                <strong>First Name: </strong>
                <input v-model="order.firstName"/>
            </p>
              <p>
                <strong>Last Name: </strong>
                <input v-model="order.lastName"/>
            </p>
            <p>
                <strong>Address: </strong>
                <input v-model="order.address"/>
            </p>
            <p>
                <strong>City: </strong>
                <input v-model="order.city"/>
            </p>
            <p>
                <strong>Phone: </strong>
                <input v-model="order.phone" placeholder="Numbers only"/>
            </p>

            <h2>Order Information</h2>
            <p>First Name: {{order.firstName}}/p>
            <p>Last Name: {{order.lastName}}</p>
            <p>Address: {{order.address}}</p>
            <p>City: {{order.city}}</p>
            <p>Phone: {{order.phone}}</p>
            <h3>Total: {{totalPrice}}</h3>
            <button v-on:click="submitForm" :disabled="!isFormValid">Place Order</button>
            <button v-on:click="backToCart">Back to cart</button>
        </div>

        <div v-if="currentPage === 'confirmation'">
            <h2>Thank you! Your lesson bookings has been placed.</h2>
            <h3>Lessons Information</h3>
            <p>Name: {{order.firstName}} {{order.lastName}}</p>
            <p>Phone: {{order.phone}}</p>
            <p>Address: {{order.address}}, {{order.city}}</p>
            <h3>Lessons:</h3>
            <ul>
                <li v-for="lesson in cart">{{lesson.subject}} - {{lesson.price}}</li>
            </ul>
            <h3>Total Paid: {{totalPrice}}</h3>
        </div>
    </main>
</div>

<script>
new Vue({
    el: '#app',
    data: {
        sitename: 'After School Lessons',
        currentPage: 'lessons',
        sortAttribute: 'subject',
        sortOrder: 'asc',
        lessons: [
            { id: 1, subject: "Math", location: "Dubai", price: 100, spaces: 5, icon: "fa-solid fa-calculator" },
            { id: 2, subject: "Science", location: "Sharjah", price: 120, spaces: 5, icon: "fa-solid fa-flask" },
            { id: 3, subject: "English", location: "Abu Dhabi", price: 90, spaces: 5, icon: "fa-solid fa-book" },
            { id: 4, subject: "History", location: "Dubai", price: 110, spaces: 5, icon: "fa-solid fa-landmark" },
            { id: 5, subject: "Geography", location: "Ajman", price: 95, spaces: 5, icon: "fa-solid fa-globe" },
            { id: 6, subject: "Physics", location: "Sharjah", price: 140, spaces: 5, icon: "fa-solid fa-atom" },
            { id: 7, subject: "Chemistry", location: "Ajman", price: 125, spaces: 5, icon: "fa-solid fa-vial" },
            { id: 8, subject: "Biology", location: "Dubai", price: 115, spaces: 5, icon: "fa-solid fa-dna" },
            { id: 9, subject: "Music", location: "Abu Dhabi", price: 80, spaces: 5, icon: "fa-solid fa-music" },
            { id: 10, subject: "Art", location: "Dubai", price: 130, spaces: 5, icon: "fa-solid fa-palette" }
        ],
        cart: [],
        order: {
            firstName:'',
            lastName:'',
            address:'',
            city:'',
            phone:''
        }
    },
    methods: {
        toggleCart() {
            if(this.currentPage === 'lessons' && this.cart.lengeth>0){
                this.currentPage = 'cart';
            } else {
                this.currentPage ='lessons';
            }
        },
        backToLessons(){
            this.currentPage='lessons';
        },
        goToCheckout(){
            this.currentPage='checkout';
        },
        backToCart(){
            this.currentPage='cart';
        },
        addToCart(lesson) {
            this.cart.push(lesson);
        },
        removeFromCart(index) {
            this.cart.splice(index, 1);
        },
        canAddToCart(lesson) {
            return lesson.spaces > this.cartCount(lesson.id);
        },
        cartCount(id) {
            return this.cart.filter(item => item.id === id).length;
        }
    },
    computed: {
        cartItemCount() {
            return this.cart.length || "";
        },
        totalPriceI(){
            return this.cart.reduce((sum, item)=> sum + item.price, 0);
        },
        sortedLessons() {
            return this.lessons.slice().sort((a, b) => {
                let modifier = this.sortOrder === 'asc' ? 1 : -1;
                if (a[this.sortAttribute] < b[this.sortAttribute]) return -1 * modifier;
                if (a[this.sortAttribute] > b[this.sortAttribute]) return 1 * modifier;
                return 0;
            });
        }
    }
});
</script>

</body>
</html>